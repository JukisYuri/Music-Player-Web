{% extends "unfold/layouts/base.html" %}
{% load i18n %}

{% block content %}
  {% if kpi %}
  <div class="grid grid-cols-1 gap-4 mb-8 md:grid-cols-2 lg:grid-cols-4">
      {% for item in kpi %}
      <div class="flex flex-col p-6 bg-white border rounded-lg shadow-sm dark:bg-gray-800 dark:border-gray-700">
          <h3 class="text-sm font-medium text-gray-500 dark:text-gray-400">{{ item.title }}</h3>
          <span class="mt-2 text-3xl font-bold text-gray-900 dark:text-gray-100">{{ item.metric }}</span>
          {% if item.footer %}
          <span class="mt-2 text-sm text-{{ item.color|default:'gray' }}-600 dark:text-{{ item.color|default:'gray' }}-400">
              {{ item.footer }}
          </span>
          {% endif %}
      </div>
      {% endfor %}
  </div>
  {% endif %}

 <div class="grid grid-cols-1 gap-6 lg:grid-cols-1">

      <div class="p-6 bg-white border rounded-lg shadow-sm dark:bg-gray-800 dark:border-gray-700">
          <h2 class="mb-4 text-lg font-semibold text-gray-900 dark:text-gray-100">
              Top 15 Bài hát nghe nhiều nhất
          </h2>
          <div class="relative h-[500px]">
              <canvas id="viewsChart"></canvas>
          </div>
      </div>

      <div class="p-6 bg-white border rounded-lg shadow-sm dark:bg-gray-800 dark:border-gray-700 " >
          <h2 class="mb-4 text-lg font-semibold text-gray-900 dark:text-gray-100">
              Top 15 Bài hát thảo luận nhiều nhất
          </h2>
          <div class="relative h-[500px]">
              <canvas id="commentsChart"></canvas>
          </div>
      </div>

  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
      document.addEventListener('DOMContentLoaded', function() {

          // Lấy dữ liệu từ Backend
          const viewsData = JSON.parse('{{ chart_views_data|safe }}');
          const commentsData = JSON.parse('{{ chart_comments_data|safe }}');

          // Cấu hình chung
          const commonOptions = {
              responsive: true,
              maintainAspectRatio: true,
              scales: {
                  y: { beginAtZero: true }
              }
          };

          // Vẽ Chart 1: Views
          new Chart(document.getElementById('viewsChart'), {
              type: 'bar',
              data: {
                  labels: viewsData.labels,
                  datasets: [{
                      label: 'Lượt nghe',
                      data: viewsData.data,
                      backgroundColor: 'rgba(16, 185, 129, 0.6)', // Xanh lá
                      borderColor: 'rgb(16, 185, 129)',
                      borderWidth: 1
                  }]
              },
              options: commonOptions
          });

          // Vẽ Chart 2: Comments
          new Chart(document.getElementById('commentsChart'), {
              type: 'bar', // Hoặc đổi thành 'pie', 'line' tùy thích
              data: {
                  labels: commentsData.labels,
                  datasets: [{
                      label: 'Bình luận',
                      data: commentsData.data,
                      backgroundColor: 'rgba(245, 158, 11, 0.6)', // Vàng cam
                      borderColor: 'rgb(245, 158, 11)',
                      borderWidth: 1,
                  }]
              },
              options: commonOptions
          });
      });
  </script>
{% endblock %}